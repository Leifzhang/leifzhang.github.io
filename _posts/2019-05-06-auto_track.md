---
layout: post
title: 华尔街见闻安卓自动化埋点开发
author: 放纵不羁爱吃肉
---


## 为什么要做这个东西

&ensp;&ensp;项目迭代过程中,开发效果的好坏其实是有数据进行支撑的，但是过于繁琐的打点业务会导致开发人员在业务代码之中不停的插入一些打点的代码，第一不便于管理，第二很浪费开发人员的时间，第三也无法做的线上动态调整的问题。
&ensp;&ensp;技术调研过程中，第一要么做一个代理，所有的点击的操作通过这个代理去操作，项目内是有对应的东西存在，但是有些额外参数的问题无法解决。第二种基于Annotation添加注解的方式去开发，基于这种切片的情况下需要对所有点击方法进行一次标准，成本太高了。第三种我们调研的结果是基于编译时插入字节码的方式去完成自动化打点。

## 怎么做的

&ensp;&ensp;做事情先思考从何入手，编译时的东西我们可以不可以调整,有没有谁做过类似的操作？查找了下资料发现gradle插件可以在项目打包之前对项目进行一次transform操作。
&ensp;&ensp;这个过程中生成的是什么东西，还有就是项目中如果有kotlin那么怎么办？最后开发的过程中发现这个时候已经把java还有kotlin代码转换成.class文件，所以我们只要找到能修改.class文件的类库就能完成准备工作了。
&ensp;&ensp;紧接上面兄弟项目java工程是如何做这种aop的项目的呢？ ASM 是一个Java 字节码操控框架。它能被用来动态生成类或者增强既有类的功能。

## 最后项目落地

&ensp;&ensp;gradle插件如何去写，首先我们要先去实现一个Plugin<Project>接口，然后在这个接口的实现方法中调用registerTransform方法。这边我就不过多的做源代码分析了，写的有点烦。

#[AndroidAutoTrack](https://github.com/Leifzhang/AndroidAutoTrack)
