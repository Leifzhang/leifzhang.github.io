---
layout: post
title: Android 构建简单的网络请求缓存（一）
author: 放纵不羁爱吃肉
---

这一章我会和大家简单的介绍下安卓端如何构建最简答的网络请求缓存。

简单点说我们需要以一段url作为一个网络请求的唯一标识符，但是正常情况下一段url会太长或者其中会有一些特殊字符，这种特殊字符是无法作为文件名来存在的，这个时候我们最简单的方式就是用url的哈希值（MD5也可以）作为文件的命，这个就是我们的缓存的key了。但是切记，如果你的url里面有任何一个类似时间戳这种随时变化的东西的时候一定要把这个剔除出去，否则就是一个无效的缓存数据了。

然后我们来介绍下请求体缓存，如果只是把数据的byte缓存下来肯定是不够的，首先我们需要知道的是我们不能够仅仅只缓存缓存网络请求的数据体，还需要将缓存时间，有效时间以及一些关键数据缓存下来。这里我只介绍本地缓存控制，关于cache-control我就不写了。

接下来就是重头戏了，讲好了数据缓存结构以及key value处理之后。现在我们要设计一个简单的生产消费者模式的request队列。简单的说这个request是其中需要包含这些关键字段，url，requestbody，cachekey等，这三个字段是必然要有的。然后我们需要把这个request丢入缓存队列，然后轮训线程回去遍历这个请求队列，然后根据cachekey去查询本地是否存在对应的file文件，如果存在我们就直接将cache从本地file取出来，如果不存在则调用网络请求，然后将获取到的网络数据缓存到本地。这样一个简单网络请求的缓存模型就已经完成初步搭建了。


[VolleyRebuild](https://github.com/Leifzhang/Volley-Okhttp-Rebulid)
